Enquadramento:
O mercado financeiro, e em especial o mercado especializado no crédito ao consumo, exige por parte das instituições de crédito a adopção e o cumprimento de princípios legais e normas de conduta. Neste contexto, identificam-se necessidades relacionadas com a gestão do negócio, designadamente com o crédito ao consumo. O crédito ao consumo é, tal como o nome indica, concedido para consumo de bens ou fornecimento de serviços.
Alguns tipos de créditos são tratados como crédito ao consumo (i. e. cartões de crédito ou crédito pessoal) para aquisição de móveis, férias, equipamentos informáticos ou electrodomésticos. O crédito automóvel é o tipo de crédito ao consumo mais comum em Portugal. A conta ordenado é outra forma de crédito ao consumo, neste caso, a pessoa pode levantar até um montante equivalente ao seu ordenado líquido como forma de antecipar o recebimento da quantia. O crédito à habitação não é considerado crédito ao consumo.


Requisitos:


O mercado do crédito ao consumo está em evolução atraindo uma quantidade crescente de empresas. Neste cenário, uma empresa portuguesa de renome pretende entrar no negócio do crédito ao consumo. Por isso, esta empresa identificou como necessidade estratégica para o sucesso do seu negócio, entre outras, o desenvolvimento de um sistema informático para efectuar a gestão da carteira de clientes da sua sucursal de Lisboa. Nesse sistema devem ser mantidos dados sobre os clientes e sobre os créditos por eles solicitados, assim como as respectivas situações.

Os atributos mais importantes do cliente são: nome, número de identificação fiscal, data de nascimento, estado civil, rendimento anual, número da conta bancária, morada e pelo menos dois contactos. 

Um cliente pode ter mais do que um crédito atribuído e pode amortizar parcial ou totalmente um crédito. Um crédito, de um tipo concreto, é identificado pelo nº da simulação e é caracterizado por um montante expresso 
numa determinada unidade monetária (pode ser em moeda estrangeira), 
uma data de início, um prazo e uma periodicidade.

 A TAEG (Taxa Anual Efectiva Global) é fixada na data de início do crédito e 
depende do tipo do crédito e da taxa de esforço do cliente1. 

Se o crédito se destinar a obras tem de ser indicada a localização do imóvel e o respectivo valor patrimonial. 

Se o crédito se destinar à compra de automóvel tem de ser indicada a matrícula, a marca e o modelo do automóvel. 

Se o crédito se destinar à compra de automóvel ou o cliente tiver rendimento anual inferior ao montante emprestado tem de ser indicado pelo menos um avalista, caracterizado como se fosse um cliente. 

Um avalista não pode dar aval a mais do que cinco créditos ou a montantes superiores ao dobro do seu rendimento anual.


Estes são os requisitos mínimos do modelo de dados a definir. No entanto, são valorizados modelos que apresentem aspectos inovadores (para além dos requisitos mínimos). Os aspectos inovadores devem reflectir não apenas a “cultura geral” mas também aspectos que introduzam facilidades de utilização interessantes. As melhorias propostas devem ser documentadas e justificadas no relatório.



Garantindo o nível de isolamento adequado, utilize procedimentos armazenados, gatilhos e scripts T-SQL, para:
a) Inserir um novo cliente ou avalista.
b) Atribuir um crédito.
c) Pagar a prestação de um crédito.
d) Amortizar parcial ou totalmente um crédito.
e) Actualizar os dados de um cliente ou avalista.
f) Apresentar os créditos de um cliente e o respectivo total.
g) Determinar a taxa de esforço de um cliente considerando só os créditos existentes.
h) Listar os nomes e contactos dos clientes em situação de incumprimento.
i) Contabilizar o montante em euros do crédito mal parado.
j) Indicar a área geográfica com maior montante de créditos atribuídos.


sucursal
Titular(  nome
          ,número de identificação fiscal
          ,data de nascimento
          ,estado civil
          ,rendimento anual
          ,número da conta bancária
          ,morada
          ,contacto 1
          ,Contacto 2
          ,Taxa de esforço ( Campo calculado )
        )  

ClienteContactos( Chave cliente, Tipo contacto, Contacto )

créditos(  Chave do crédito  ( Nº simulação )
          ,chave do cliente
          ,Estado ( simulação, credito ) 
          ,Tipo de credito
          ,Montante
          ,Moeda         
          ,uma data de início
          ,prazo
          ,periodicidade
          ,TAEG (Taxa Anual Efectiva Global) - Depende da lk_TipoCredito.TAEG Referencia e da tx de esfoço do criente
        )

Credito Obras(
                 Chave do crédito
                 Morada Linha 1
                 Morada Linha 2
                 codigo  Postal 1
                 codigo  Postal 2
                 valor patrimonial                   
             )

Credito Viaturas (
                    Chave do crédito
                    Matricula
                    Marca 
                    Modelo ( ??? deve ficar numa tabela de lk ??? )
                    Id Cliente Avalista ( Valido quando cliente tiver rendimento anual inferior ao montante emprestado )
                 )


Credito Viaturas Avalistas (  Chave do crédito
                              ,Id Cliente Avalista
                           )
                           Regra de negócio -> Um avalista não pode dar aval a mais do que cinco créditos ou a montantes superiores ao dobro do seu rendimento anual. Aplicada como uma restrição aplicacional



lk_TipoCredito(  id Tipo Credito		
                ,Nome
                ,Descrição
                ,Montante Maximo
                ,TAEG Referencia
                ,Tipo de Credito ( Obras 
              ) 


